{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.storage = void 0;\nconst utils_1 = require(\"@trezor/utils\");\nconst storageVersion = 2;\nconst storageName = `storage_v${storageVersion}`;\nconst getEmptyState = () => ({\n  origin: {}\n});\nlet memoryStorage = getEmptyState();\nconst getPermanentStorage = () => {\n  const ls = localStorage.getItem(storageName);\n  return ls ? JSON.parse(ls) : getEmptyState();\n};\nclass Storage extends utils_1.TypedEmitter {\n  save(getNewState, temporary = false) {\n    if (temporary || !global.window) {\n      memoryStorage = getNewState(memoryStorage);\n      return;\n    }\n    try {\n      const newState = getNewState(getPermanentStorage());\n      localStorage.setItem(storageName, JSON.stringify(newState));\n      this.emit('changed', newState);\n    } catch (_a) {\n      console.warn('long term storage not available');\n      memoryStorage = getNewState(memoryStorage);\n    }\n  }\n  saveForOrigin(getNewState, origin, temporary = false) {\n    this.save(state => {\n      var _a;\n      return Object.assign(Object.assign({}, state), {\n        origin: Object.assign(Object.assign({}, state.origin), {\n          [origin]: getNewState(((_a = state.origin) === null || _a === void 0 ? void 0 : _a[origin]) || {})\n        })\n      });\n    }, temporary);\n  }\n  load(temporary = false) {\n    var _a;\n    if (temporary || !((_a = global === null || global === void 0 ? void 0 : global.window) === null || _a === void 0 ? void 0 : _a.localStorage)) {\n      return memoryStorage;\n    }\n    try {\n      return getPermanentStorage();\n    } catch (_b) {\n      console.warn('long term storage not available');\n      return memoryStorage;\n    }\n  }\n  loadForOrigin(origin, temporary = false) {\n    var _a;\n    const state = this.load(temporary);\n    return ((_a = state.origin) === null || _a === void 0 ? void 0 : _a[origin]) || {};\n  }\n}\nconst storage = new Storage();\nexports.storage = storage;","map":{"version":3,"names":["Object","defineProperty","exports","value","storage","utils_1","require","storageVersion","storageName","getEmptyState","origin","memoryStorage","getPermanentStorage","ls","localStorage","getItem","JSON","parse","Storage","TypedEmitter","save","getNewState","temporary","global","window","newState","setItem","stringify","emit","_a","console","warn","saveForOrigin","state","assign","load","_b","loadForOrigin"],"sources":["/Users/papa/Desktop/trenchboard/trenchboard.io/node_modules/@trezor/connect-common/lib/storage.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.storage = void 0;\nconst utils_1 = require(\"@trezor/utils\");\nconst storageVersion = 2;\nconst storageName = `storage_v${storageVersion}`;\nconst getEmptyState = () => ({\n    origin: {},\n});\nlet memoryStorage = getEmptyState();\nconst getPermanentStorage = () => {\n    const ls = localStorage.getItem(storageName);\n    return ls ? JSON.parse(ls) : getEmptyState();\n};\nclass Storage extends utils_1.TypedEmitter {\n    save(getNewState, temporary = false) {\n        if (temporary || !global.window) {\n            memoryStorage = getNewState(memoryStorage);\n            return;\n        }\n        try {\n            const newState = getNewState(getPermanentStorage());\n            localStorage.setItem(storageName, JSON.stringify(newState));\n            this.emit('changed', newState);\n        }\n        catch (_a) {\n            console.warn('long term storage not available');\n            memoryStorage = getNewState(memoryStorage);\n        }\n    }\n    saveForOrigin(getNewState, origin, temporary = false) {\n        this.save(state => {\n            var _a;\n            return (Object.assign(Object.assign({}, state), { origin: Object.assign(Object.assign({}, state.origin), { [origin]: getNewState(((_a = state.origin) === null || _a === void 0 ? void 0 : _a[origin]) || {}) }) }));\n        }, temporary);\n    }\n    load(temporary = false) {\n        var _a;\n        if (temporary || !((_a = global === null || global === void 0 ? void 0 : global.window) === null || _a === void 0 ? void 0 : _a.localStorage)) {\n            return memoryStorage;\n        }\n        try {\n            return getPermanentStorage();\n        }\n        catch (_b) {\n            console.warn('long term storage not available');\n            return memoryStorage;\n        }\n    }\n    loadForOrigin(origin, temporary = false) {\n        var _a;\n        const state = this.load(temporary);\n        return ((_a = state.origin) === null || _a === void 0 ? void 0 : _a[origin]) || {};\n    }\n}\nconst storage = new Storage();\nexports.storage = storage;\n//# sourceMappingURL=storage.js.map"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}