{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TrezorConnectDynamic = void 0;\nconst constants_1 = require(\"../constants\");\nconst proxy_event_emitter_1 = require(\"../utils/proxy-event-emitter\");\nclass TrezorConnectDynamic {\n  constructor({\n    implementations,\n    getInitTarget,\n    handleErrorFallback\n  }) {\n    this.implementations = implementations;\n    this.currentTarget = this.implementations[0].type;\n    this.getInitTarget = getInitTarget;\n    this.handleErrorFallback = handleErrorFallback;\n    this.eventEmitter = new proxy_event_emitter_1.ProxyEventEmitter(this.implementations.map(impl => impl.impl.eventEmitter));\n  }\n  getTarget() {\n    return this.implementations.find(impl => impl.type === this.currentTarget).impl;\n  }\n  async switchTarget(target) {\n    if (this.currentTarget === target) {\n      return;\n    }\n    if (!this.lastSettings) {\n      throw constants_1.ERRORS.TypedError('Init_NotInitialized');\n    }\n    await this.getTarget().dispose();\n    this.currentTarget = target;\n    await this.getTarget().init(this.lastSettings);\n  }\n  manifest(manifest) {\n    this.lastSettings = {\n      ...this.lastSettings,\n      manifest\n    };\n    this.getTarget().manifest(manifest);\n  }\n  async init(settings) {\n    if (!(settings === null || settings === void 0 ? void 0 : settings.manifest)) {\n      throw constants_1.ERRORS.TypedError('Init_ManifestMissing');\n    }\n    this.lastSettings = settings;\n    this.currentTarget = this.getInitTarget(settings);\n    try {\n      return await this.getTarget().init(this.lastSettings);\n    } catch (error) {\n      if (await this.handleErrorFallback(error.code)) {\n        return await this.getTarget().init(settings);\n      }\n      throw error;\n    }\n  }\n  async call(params) {\n    const response = await this.getTarget().call(params);\n    if (!response.success) {\n      if (await this.handleErrorFallback(response.payload.code)) {\n        return await this.getTarget().call(params);\n      }\n    }\n    return response;\n  }\n  requestLogin(params) {\n    return this.getTarget().requestLogin(params);\n  }\n  uiResponse(params) {\n    return this.getTarget().uiResponse(params);\n  }\n  cancel(error) {\n    return this.getTarget().cancel(error);\n  }\n  dispose() {\n    this.eventEmitter.removeAllListeners();\n    return this.getTarget().dispose();\n  }\n}\nexports.TrezorConnectDynamic = TrezorConnectDynamic;","map":{"version":3,"names":["Object","defineProperty","exports","value","TrezorConnectDynamic","constants_1","require","proxy_event_emitter_1","constructor","implementations","getInitTarget","handleErrorFallback","currentTarget","type","eventEmitter","ProxyEventEmitter","map","impl","getTarget","find","switchTarget","target","lastSettings","ERRORS","TypedError","dispose","init","manifest","settings","error","code","call","params","response","success","payload","requestLogin","uiResponse","cancel","removeAllListeners"],"sources":["/Users/papa/Desktop/trenchboard/trenchboard.io/node_modules/@trezor/connect/lib/impl/dynamic.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TrezorConnectDynamic = void 0;\nconst constants_1 = require(\"../constants\");\nconst proxy_event_emitter_1 = require(\"../utils/proxy-event-emitter\");\nclass TrezorConnectDynamic {\n    constructor({ implementations, getInitTarget, handleErrorFallback, }) {\n        this.implementations = implementations;\n        this.currentTarget = this.implementations[0].type;\n        this.getInitTarget = getInitTarget;\n        this.handleErrorFallback = handleErrorFallback;\n        this.eventEmitter = new proxy_event_emitter_1.ProxyEventEmitter(this.implementations.map(impl => impl.impl.eventEmitter));\n    }\n    getTarget() {\n        return this.implementations.find(impl => impl.type === this.currentTarget).impl;\n    }\n    async switchTarget(target) {\n        if (this.currentTarget === target) {\n            return;\n        }\n        if (!this.lastSettings) {\n            throw constants_1.ERRORS.TypedError('Init_NotInitialized');\n        }\n        await this.getTarget().dispose();\n        this.currentTarget = target;\n        await this.getTarget().init(this.lastSettings);\n    }\n    manifest(manifest) {\n        this.lastSettings = {\n            ...this.lastSettings,\n            manifest,\n        };\n        this.getTarget().manifest(manifest);\n    }\n    async init(settings) {\n        if (!(settings === null || settings === void 0 ? void 0 : settings.manifest)) {\n            throw constants_1.ERRORS.TypedError('Init_ManifestMissing');\n        }\n        this.lastSettings = settings;\n        this.currentTarget = this.getInitTarget(settings);\n        try {\n            return await this.getTarget().init(this.lastSettings);\n        }\n        catch (error) {\n            if (await this.handleErrorFallback(error.code)) {\n                return await this.getTarget().init(settings);\n            }\n            throw error;\n        }\n    }\n    async call(params) {\n        const response = await this.getTarget().call(params);\n        if (!response.success) {\n            if (await this.handleErrorFallback(response.payload.code)) {\n                return await this.getTarget().call(params);\n            }\n        }\n        return response;\n    }\n    requestLogin(params) {\n        return this.getTarget().requestLogin(params);\n    }\n    uiResponse(params) {\n        return this.getTarget().uiResponse(params);\n    }\n    cancel(error) {\n        return this.getTarget().cancel(error);\n    }\n    dispose() {\n        this.eventEmitter.removeAllListeners();\n        return this.getTarget().dispose();\n    }\n}\nexports.TrezorConnectDynamic = TrezorConnectDynamic;\n//# sourceMappingURL=dynamic.js.map"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}