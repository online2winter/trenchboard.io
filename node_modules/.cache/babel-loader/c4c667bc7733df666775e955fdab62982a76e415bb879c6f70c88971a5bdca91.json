{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createDeferredManager = void 0;\nconst createDeferred_1 = require(\"./createDeferred\");\nconst createDeferredManager = options => {\n  const {\n    initialId = 0,\n    timeout: defaultTimeout = 0,\n    onTimeout\n  } = options !== null && options !== void 0 ? options : {};\n  const promises = [];\n  let ID = initialId;\n  let timeoutHandle;\n  const length = () => promises.length;\n  const nextId = () => ID;\n  const replanTimeout = () => {\n    const now = Date.now();\n    const nearestDeadline = promises.reduce((prev, {\n      deadline\n    }) => (prev && deadline ? Math.min : Math.max)(prev, deadline), 0);\n    if (timeoutHandle) clearTimeout(timeoutHandle);\n    timeoutHandle = nearestDeadline ? setTimeout(timeoutCallback, Math.max(nearestDeadline - now, 0)) : undefined;\n  };\n  const timeoutCallback = () => {\n    const now = Date.now();\n    promises.filter(promise => promise.deadline && promise.deadline <= now).forEach(promise => {\n      onTimeout === null || onTimeout === void 0 ? void 0 : onTimeout(promise.id);\n      promise.deadline = 0;\n    });\n    replanTimeout();\n  };\n  const create = (timeout = defaultTimeout) => {\n    const promiseId = ID++;\n    const deferred = (0, createDeferred_1.createDeferred)(promiseId);\n    const deadline = timeout && Date.now() + timeout;\n    promises.push(Object.assign(Object.assign({}, deferred), {\n      deadline\n    }));\n    if (timeout) replanTimeout();\n    return {\n      promiseId,\n      promise: deferred.promise\n    };\n  };\n  const extract = promiseId => {\n    const index = promises.findIndex(({\n      id\n    }) => id === promiseId);\n    const [promise] = index >= 0 ? promises.splice(index, 1) : [undefined];\n    if (promise === null || promise === void 0 ? void 0 : promise.deadline) replanTimeout();\n    return promise;\n  };\n  const resolve = (promiseId, value) => {\n    const promise = extract(promiseId);\n    promise === null || promise === void 0 ? void 0 : promise.resolve(value);\n    return !!promise;\n  };\n  const reject = (promiseId, error) => {\n    const promise = extract(promiseId);\n    promise === null || promise === void 0 ? void 0 : promise.reject(error);\n    return !!promise;\n  };\n  const rejectAll = error => {\n    promises.forEach(promise => promise.reject(error));\n    const deleted = promises.splice(0, promises.length);\n    if (deleted.length) replanTimeout();\n  };\n  return {\n    length,\n    nextId,\n    create,\n    resolve,\n    reject,\n    rejectAll\n  };\n};\nexports.createDeferredManager = createDeferredManager;","map":{"version":3,"names":["Object","defineProperty","exports","value","createDeferredManager","createDeferred_1","require","options","initialId","timeout","defaultTimeout","onTimeout","promises","ID","timeoutHandle","length","nextId","replanTimeout","now","Date","nearestDeadline","reduce","prev","deadline","Math","min","max","clearTimeout","setTimeout","timeoutCallback","undefined","filter","promise","forEach","id","create","promiseId","deferred","createDeferred","push","assign","extract","index","findIndex","splice","resolve","reject","error","rejectAll","deleted"],"sources":["/Users/papa/Desktop/trenchboard/trenchboard.io/node_modules/@trezor/utils/lib/createDeferredManager.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createDeferredManager = void 0;\nconst createDeferred_1 = require(\"./createDeferred\");\nconst createDeferredManager = (options) => {\n    const { initialId = 0, timeout: defaultTimeout = 0, onTimeout } = options !== null && options !== void 0 ? options : {};\n    const promises = [];\n    let ID = initialId;\n    let timeoutHandle;\n    const length = () => promises.length;\n    const nextId = () => ID;\n    const replanTimeout = () => {\n        const now = Date.now();\n        const nearestDeadline = promises.reduce((prev, { deadline }) => (prev && deadline ? Math.min : Math.max)(prev, deadline), 0);\n        if (timeoutHandle)\n            clearTimeout(timeoutHandle);\n        timeoutHandle = nearestDeadline\n            ?\n                setTimeout(timeoutCallback, Math.max(nearestDeadline - now, 0))\n            : undefined;\n    };\n    const timeoutCallback = () => {\n        const now = Date.now();\n        promises\n            .filter(promise => promise.deadline && promise.deadline <= now)\n            .forEach(promise => {\n            onTimeout === null || onTimeout === void 0 ? void 0 : onTimeout(promise.id);\n            promise.deadline = 0;\n        });\n        replanTimeout();\n    };\n    const create = (timeout = defaultTimeout) => {\n        const promiseId = ID++;\n        const deferred = (0, createDeferred_1.createDeferred)(promiseId);\n        const deadline = timeout && Date.now() + timeout;\n        promises.push(Object.assign(Object.assign({}, deferred), { deadline }));\n        if (timeout)\n            replanTimeout();\n        return { promiseId, promise: deferred.promise };\n    };\n    const extract = (promiseId) => {\n        const index = promises.findIndex(({ id }) => id === promiseId);\n        const [promise] = index >= 0 ? promises.splice(index, 1) : [undefined];\n        if (promise === null || promise === void 0 ? void 0 : promise.deadline)\n            replanTimeout();\n        return promise;\n    };\n    const resolve = (promiseId, value) => {\n        const promise = extract(promiseId);\n        promise === null || promise === void 0 ? void 0 : promise.resolve(value);\n        return !!promise;\n    };\n    const reject = (promiseId, error) => {\n        const promise = extract(promiseId);\n        promise === null || promise === void 0 ? void 0 : promise.reject(error);\n        return !!promise;\n    };\n    const rejectAll = (error) => {\n        promises.forEach(promise => promise.reject(error));\n        const deleted = promises.splice(0, promises.length);\n        if (deleted.length)\n            replanTimeout();\n    };\n    return { length, nextId, create, resolve, reject, rejectAll };\n};\nexports.createDeferredManager = createDeferredManager;\n//# sourceMappingURL=createDeferredManager.js.map"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}