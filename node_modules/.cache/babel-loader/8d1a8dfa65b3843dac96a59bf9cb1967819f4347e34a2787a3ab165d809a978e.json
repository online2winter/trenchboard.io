{"ast":null,"code":"class WebSocketService {\n  constructor() {\n    this.ws = null;\n    this.subscribers = new Map();\n    this.isConnected = false;\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.reconnectTimeout = null;\n    console.log('WebSocketService initialized');\n  }\n  connect() {\n    try {\n      console.log('Connecting to pumpportal.fun WebSocket...');\n      this.ws = new WebSocket('wss://pumpportal.fun/api/data');\n      this.ws.onopen = () => {\n        console.log('WebSocket Connected');\n        this.isConnected = true;\n        this.reconnectAttempts = 0;\n\n        // Subscribe to new token events by default\n        const payload = {\n          method: \"subscribeNewToken\"\n        };\n        this.ws.send(JSON.stringify(payload));\n\n        // Notify all subscribers of connection status\n        this.subscribers.forEach((callback, id) => {\n          callback({\n            type: 'connection',\n            status: 'connected'\n          });\n        });\n      };\n      this.ws.onmessage = event => {\n        try {\n          const data = JSON.parse(event.data);\n          // Notify all subscribers\n          this.subscribers.forEach((callback, id) => {\n            console.log(`Notifying subscriber ${id}`);\n            callback(data);\n          });\n        } catch (error) {\n          console.error('Error parsing WebSocket message:', error);\n        }\n      };\n      this.ws.onclose = () => {\n        this.isConnected = false;\n        console.log('WebSocket Disconnected');\n\n        // Notify all subscribers of connection status\n        this.subscribers.forEach((callback, id) => {\n          callback({\n            type: 'connection',\n            status: 'disconnected'\n          });\n        });\n        this.attemptReconnect();\n      };\n      this.ws.onerror = error => {\n        console.error('WebSocket Error:', error);\n        // Notify all subscribers of connection error\n        this.subscribers.forEach((callback, id) => {\n          callback({\n            type: 'connection',\n            status: 'error',\n            error\n          });\n        });\n      };\n    } catch (error) {\n      console.error('Error creating WebSocket connection:', error);\n      this.attemptReconnect();\n    }\n  }\n  attemptReconnect() {\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\n      this.reconnectAttempts++;\n      this.reconnectTimeout = setTimeout(() => {\n        console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\n        this.connect();\n      }, 5000 * this.reconnectAttempts); // Exponential backoff\n    }\n  }\n  subscribeToAccountTrades(accounts) {\n    if (this.isConnected && Array.isArray(accounts) && accounts.length > 0) {\n      const payload = {\n        method: \"subscribeAccountTrade\",\n        keys: accounts\n      };\n      this.ws.send(JSON.stringify(payload));\n    }\n  }\n  subscribeToTokenTrades(tokens) {\n    if (this.isConnected && Array.isArray(tokens) && tokens.length > 0) {\n      const payload = {\n        method: \"subscribeTokenTrade\",\n        keys: tokens\n      };\n      this.ws.send(JSON.stringify(payload));\n    }\n  }\n\n  // Method to check connection status\n  getConnectionStatus() {\n    return {\n      isConnected: this.isConnected,\n      reconnectAttempts: this.reconnectAttempts,\n      subscriberCount: this.subscribers.size\n    };\n  }\n  subscribe(id, callback) {\n    console.log(`New subscriber registered: ${id}`);\n    this.subscribers.set(id, callback);\n\n    // If this is the first subscriber, establish connection\n    if (this.subscribers.size === 1) {\n      console.log('First subscriber connected, establishing WebSocket connection');\n      this.connect();\n    } else if (this.isConnected) {\n      // If already connected, notify the new subscriber of current status\n      callback({\n        type: 'connection',\n        status: 'connected'\n      });\n    }\n    console.log('Current subscribers:', Array.from(this.subscribers.keys()));\n    return () => this.unsubscribe(id);\n  }\n  unsubscribe(id) {\n    console.log(`Unsubscribing: ${id}`);\n    this.subscribers.delete(id);\n\n    // If there are no more subscribers, close the connection\n    if (this.subscribers.size === 0) {\n      console.log('No more subscribers, closing WebSocket connection');\n      this.disconnect();\n    }\n    console.log('Remaining subscribers:', Array.from(this.subscribers.keys()));\n  }\n  disconnect() {\n    if (this.reconnectTimeout) {\n      clearTimeout(this.reconnectTimeout);\n      this.reconnectTimeout = null;\n    }\n    if (this.ws) {\n      this.ws.close();\n      this.ws = null;\n    }\n    this.isConnected = false;\n  }\n}\n\n// Create a singleton instance\nconst websocketService = new WebSocketService();\nexport default websocketService;","map":{"version":3,"names":["WebSocketService","constructor","ws","subscribers","Map","isConnected","reconnectAttempts","maxReconnectAttempts","reconnectTimeout","console","log","connect","WebSocket","onopen","payload","method","send","JSON","stringify","forEach","callback","id","type","status","onmessage","event","data","parse","error","onclose","attemptReconnect","onerror","setTimeout","subscribeToAccountTrades","accounts","Array","isArray","length","keys","subscribeToTokenTrades","tokens","getConnectionStatus","subscriberCount","size","subscribe","set","from","unsubscribe","delete","disconnect","clearTimeout","close","websocketService"],"sources":["/Users/papa/Desktop/trenchboard/trenchboard.io/src/utils/websocket.js"],"sourcesContent":["class WebSocketService {\n  constructor() {\n    this.ws = null;\n    this.subscribers = new Map();\n    this.isConnected = false;\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.reconnectTimeout = null;\n    console.log('WebSocketService initialized');\n  }\n\n  connect() {\n    try {\n      console.log('Connecting to pumpportal.fun WebSocket...');\n      this.ws = new WebSocket('wss://pumpportal.fun/api/data');\n      \n      this.ws.onopen = () => {\n        console.log('WebSocket Connected');\n        this.isConnected = true;\n        this.reconnectAttempts = 0;\n        \n        // Subscribe to new token events by default\n        const payload = {\n          method: \"subscribeNewToken\"\n        };\n        this.ws.send(JSON.stringify(payload));\n\n        // Notify all subscribers of connection status\n        this.subscribers.forEach((callback, id) => {\n          callback({ type: 'connection', status: 'connected' });\n        });\n      };\n\n      this.ws.onmessage = (event) => {\n        try {\n          const data = JSON.parse(event.data);\n          // Notify all subscribers\n          this.subscribers.forEach((callback, id) => {\n            console.log(`Notifying subscriber ${id}`);\n            callback(data);\n          });\n        } catch (error) {\n          console.error('Error parsing WebSocket message:', error);\n        }\n      };\n\n      this.ws.onclose = () => {\n        this.isConnected = false;\n        console.log('WebSocket Disconnected');\n        \n        // Notify all subscribers of connection status\n        this.subscribers.forEach((callback, id) => {\n          callback({ type: 'connection', status: 'disconnected' });\n        });\n        \n        this.attemptReconnect();\n      };\n\n      this.ws.onerror = (error) => {\n        console.error('WebSocket Error:', error);\n        // Notify all subscribers of connection error\n        this.subscribers.forEach((callback, id) => {\n          callback({ type: 'connection', status: 'error', error });\n        });\n      };\n    } catch (error) {\n      console.error('Error creating WebSocket connection:', error);\n      this.attemptReconnect();\n    }\n  }\n\n  attemptReconnect() {\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\n      this.reconnectAttempts++;\n      this.reconnectTimeout = setTimeout(() => {\n        console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\n        this.connect();\n      }, 5000 * this.reconnectAttempts); // Exponential backoff\n    }\n  }\n\n  subscribeToAccountTrades(accounts) {\n    if (this.isConnected && Array.isArray(accounts) && accounts.length > 0) {\n      const payload = {\n        method: \"subscribeAccountTrade\",\n        keys: accounts\n      };\n      this.ws.send(JSON.stringify(payload));\n    }\n  }\n\n  subscribeToTokenTrades(tokens) {\n    if (this.isConnected && Array.isArray(tokens) && tokens.length > 0) {\n      const payload = {\n        method: \"subscribeTokenTrade\",\n        keys: tokens\n      };\n      this.ws.send(JSON.stringify(payload));\n    }\n  }\n\n  // Method to check connection status\n  getConnectionStatus() {\n    return {\n      isConnected: this.isConnected,\n      reconnectAttempts: this.reconnectAttempts,\n      subscriberCount: this.subscribers.size\n    };\n  }\n\n  subscribe(id, callback) {\n    console.log(`New subscriber registered: ${id}`);\n    this.subscribers.set(id, callback);\n    \n    // If this is the first subscriber, establish connection\n    if (this.subscribers.size === 1) {\n      console.log('First subscriber connected, establishing WebSocket connection');\n      this.connect();\n    } else if (this.isConnected) {\n      // If already connected, notify the new subscriber of current status\n      callback({ type: 'connection', status: 'connected' });\n    }\n\n    console.log('Current subscribers:', Array.from(this.subscribers.keys()));\n    return () => this.unsubscribe(id);\n  }\n\n  unsubscribe(id) {\n    console.log(`Unsubscribing: ${id}`);\n    this.subscribers.delete(id);\n    \n    // If there are no more subscribers, close the connection\n    if (this.subscribers.size === 0) {\n      console.log('No more subscribers, closing WebSocket connection');\n      this.disconnect();\n    }\n\n    console.log('Remaining subscribers:', Array.from(this.subscribers.keys()));\n  }\n\n  disconnect() {\n    if (this.reconnectTimeout) {\n      clearTimeout(this.reconnectTimeout);\n      this.reconnectTimeout = null;\n    }\n    \n    if (this.ws) {\n      this.ws.close();\n      this.ws = null;\n    }\n    \n    this.isConnected = false;\n  }\n}\n\n// Create a singleton instance\nconst websocketService = new WebSocketService();\nexport default websocketService;"],"mappings":"AAAA,MAAMA,gBAAgB,CAAC;EACrBC,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACC,EAAE,GAAG,IAAI;IACd,IAAI,CAACC,WAAW,GAAG,IAAIC,GAAG,CAAC,CAAC;IAC5B,IAAI,CAACC,WAAW,GAAG,KAAK;IACxB,IAAI,CAACC,iBAAiB,GAAG,CAAC;IAC1B,IAAI,CAACC,oBAAoB,GAAG,CAAC;IAC7B,IAAI,CAACC,gBAAgB,GAAG,IAAI;IAC5BC,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAC;EAC7C;EAEAC,OAAOA,CAAA,EAAG;IACR,IAAI;MACFF,OAAO,CAACC,GAAG,CAAC,2CAA2C,CAAC;MACxD,IAAI,CAACR,EAAE,GAAG,IAAIU,SAAS,CAAC,+BAA+B,CAAC;MAExD,IAAI,CAACV,EAAE,CAACW,MAAM,GAAG,MAAM;QACrBJ,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAC;QAClC,IAAI,CAACL,WAAW,GAAG,IAAI;QACvB,IAAI,CAACC,iBAAiB,GAAG,CAAC;;QAE1B;QACA,MAAMQ,OAAO,GAAG;UACdC,MAAM,EAAE;QACV,CAAC;QACD,IAAI,CAACb,EAAE,CAACc,IAAI,CAACC,IAAI,CAACC,SAAS,CAACJ,OAAO,CAAC,CAAC;;QAErC;QACA,IAAI,CAACX,WAAW,CAACgB,OAAO,CAAC,CAACC,QAAQ,EAAEC,EAAE,KAAK;UACzCD,QAAQ,CAAC;YAAEE,IAAI,EAAE,YAAY;YAAEC,MAAM,EAAE;UAAY,CAAC,CAAC;QACvD,CAAC,CAAC;MACJ,CAAC;MAED,IAAI,CAACrB,EAAE,CAACsB,SAAS,GAAIC,KAAK,IAAK;QAC7B,IAAI;UACF,MAAMC,IAAI,GAAGT,IAAI,CAACU,KAAK,CAACF,KAAK,CAACC,IAAI,CAAC;UACnC;UACA,IAAI,CAACvB,WAAW,CAACgB,OAAO,CAAC,CAACC,QAAQ,EAAEC,EAAE,KAAK;YACzCZ,OAAO,CAACC,GAAG,CAAC,wBAAwBW,EAAE,EAAE,CAAC;YACzCD,QAAQ,CAACM,IAAI,CAAC;UAChB,CAAC,CAAC;QACJ,CAAC,CAAC,OAAOE,KAAK,EAAE;UACdnB,OAAO,CAACmB,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;QAC1D;MACF,CAAC;MAED,IAAI,CAAC1B,EAAE,CAAC2B,OAAO,GAAG,MAAM;QACtB,IAAI,CAACxB,WAAW,GAAG,KAAK;QACxBI,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAC;;QAErC;QACA,IAAI,CAACP,WAAW,CAACgB,OAAO,CAAC,CAACC,QAAQ,EAAEC,EAAE,KAAK;UACzCD,QAAQ,CAAC;YAAEE,IAAI,EAAE,YAAY;YAAEC,MAAM,EAAE;UAAe,CAAC,CAAC;QAC1D,CAAC,CAAC;QAEF,IAAI,CAACO,gBAAgB,CAAC,CAAC;MACzB,CAAC;MAED,IAAI,CAAC5B,EAAE,CAAC6B,OAAO,GAAIH,KAAK,IAAK;QAC3BnB,OAAO,CAACmB,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAAC;QACxC;QACA,IAAI,CAACzB,WAAW,CAACgB,OAAO,CAAC,CAACC,QAAQ,EAAEC,EAAE,KAAK;UACzCD,QAAQ,CAAC;YAAEE,IAAI,EAAE,YAAY;YAAEC,MAAM,EAAE,OAAO;YAAEK;UAAM,CAAC,CAAC;QAC1D,CAAC,CAAC;MACJ,CAAC;IACH,CAAC,CAAC,OAAOA,KAAK,EAAE;MACdnB,OAAO,CAACmB,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;MAC5D,IAAI,CAACE,gBAAgB,CAAC,CAAC;IACzB;EACF;EAEAA,gBAAgBA,CAAA,EAAG;IACjB,IAAI,IAAI,CAACxB,iBAAiB,GAAG,IAAI,CAACC,oBAAoB,EAAE;MACtD,IAAI,CAACD,iBAAiB,EAAE;MACxB,IAAI,CAACE,gBAAgB,GAAGwB,UAAU,CAAC,MAAM;QACvCvB,OAAO,CAACC,GAAG,CAAC,+BAA+B,IAAI,CAACJ,iBAAiB,IAAI,IAAI,CAACC,oBAAoB,GAAG,CAAC;QAClG,IAAI,CAACI,OAAO,CAAC,CAAC;MAChB,CAAC,EAAE,IAAI,GAAG,IAAI,CAACL,iBAAiB,CAAC,CAAC,CAAC;IACrC;EACF;EAEA2B,wBAAwBA,CAACC,QAAQ,EAAE;IACjC,IAAI,IAAI,CAAC7B,WAAW,IAAI8B,KAAK,CAACC,OAAO,CAACF,QAAQ,CAAC,IAAIA,QAAQ,CAACG,MAAM,GAAG,CAAC,EAAE;MACtE,MAAMvB,OAAO,GAAG;QACdC,MAAM,EAAE,uBAAuB;QAC/BuB,IAAI,EAAEJ;MACR,CAAC;MACD,IAAI,CAAChC,EAAE,CAACc,IAAI,CAACC,IAAI,CAACC,SAAS,CAACJ,OAAO,CAAC,CAAC;IACvC;EACF;EAEAyB,sBAAsBA,CAACC,MAAM,EAAE;IAC7B,IAAI,IAAI,CAACnC,WAAW,IAAI8B,KAAK,CAACC,OAAO,CAACI,MAAM,CAAC,IAAIA,MAAM,CAACH,MAAM,GAAG,CAAC,EAAE;MAClE,MAAMvB,OAAO,GAAG;QACdC,MAAM,EAAE,qBAAqB;QAC7BuB,IAAI,EAAEE;MACR,CAAC;MACD,IAAI,CAACtC,EAAE,CAACc,IAAI,CAACC,IAAI,CAACC,SAAS,CAACJ,OAAO,CAAC,CAAC;IACvC;EACF;;EAEA;EACA2B,mBAAmBA,CAAA,EAAG;IACpB,OAAO;MACLpC,WAAW,EAAE,IAAI,CAACA,WAAW;MAC7BC,iBAAiB,EAAE,IAAI,CAACA,iBAAiB;MACzCoC,eAAe,EAAE,IAAI,CAACvC,WAAW,CAACwC;IACpC,CAAC;EACH;EAEAC,SAASA,CAACvB,EAAE,EAAED,QAAQ,EAAE;IACtBX,OAAO,CAACC,GAAG,CAAC,8BAA8BW,EAAE,EAAE,CAAC;IAC/C,IAAI,CAAClB,WAAW,CAAC0C,GAAG,CAACxB,EAAE,EAAED,QAAQ,CAAC;;IAElC;IACA,IAAI,IAAI,CAACjB,WAAW,CAACwC,IAAI,KAAK,CAAC,EAAE;MAC/BlC,OAAO,CAACC,GAAG,CAAC,+DAA+D,CAAC;MAC5E,IAAI,CAACC,OAAO,CAAC,CAAC;IAChB,CAAC,MAAM,IAAI,IAAI,CAACN,WAAW,EAAE;MAC3B;MACAe,QAAQ,CAAC;QAAEE,IAAI,EAAE,YAAY;QAAEC,MAAM,EAAE;MAAY,CAAC,CAAC;IACvD;IAEAd,OAAO,CAACC,GAAG,CAAC,sBAAsB,EAAEyB,KAAK,CAACW,IAAI,CAAC,IAAI,CAAC3C,WAAW,CAACmC,IAAI,CAAC,CAAC,CAAC,CAAC;IACxE,OAAO,MAAM,IAAI,CAACS,WAAW,CAAC1B,EAAE,CAAC;EACnC;EAEA0B,WAAWA,CAAC1B,EAAE,EAAE;IACdZ,OAAO,CAACC,GAAG,CAAC,kBAAkBW,EAAE,EAAE,CAAC;IACnC,IAAI,CAAClB,WAAW,CAAC6C,MAAM,CAAC3B,EAAE,CAAC;;IAE3B;IACA,IAAI,IAAI,CAAClB,WAAW,CAACwC,IAAI,KAAK,CAAC,EAAE;MAC/BlC,OAAO,CAACC,GAAG,CAAC,mDAAmD,CAAC;MAChE,IAAI,CAACuC,UAAU,CAAC,CAAC;IACnB;IAEAxC,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAEyB,KAAK,CAACW,IAAI,CAAC,IAAI,CAAC3C,WAAW,CAACmC,IAAI,CAAC,CAAC,CAAC,CAAC;EAC5E;EAEAW,UAAUA,CAAA,EAAG;IACX,IAAI,IAAI,CAACzC,gBAAgB,EAAE;MACzB0C,YAAY,CAAC,IAAI,CAAC1C,gBAAgB,CAAC;MACnC,IAAI,CAACA,gBAAgB,GAAG,IAAI;IAC9B;IAEA,IAAI,IAAI,CAACN,EAAE,EAAE;MACX,IAAI,CAACA,EAAE,CAACiD,KAAK,CAAC,CAAC;MACf,IAAI,CAACjD,EAAE,GAAG,IAAI;IAChB;IAEA,IAAI,CAACG,WAAW,GAAG,KAAK;EAC1B;AACF;;AAEA;AACA,MAAM+C,gBAAgB,GAAG,IAAIpD,gBAAgB,CAAC,CAAC;AAC/C,eAAeoD,gBAAgB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}