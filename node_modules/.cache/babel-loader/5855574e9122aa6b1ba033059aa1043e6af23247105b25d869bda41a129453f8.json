{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TrezorConnect = exports.CoreInSuiteDesktop = void 0;\nconst tslib_1 = require(\"tslib\");\nconst events_1 = tslib_1.__importDefault(require(\"events\"));\nconst events_2 = require(\"@trezor/connect/lib/events\");\nconst ERRORS = tslib_1.__importStar(require(\"@trezor/connect/lib/constants/errors\"));\nconst factory_1 = require(\"@trezor/connect/lib/factory\");\nconst utils_1 = require(\"@trezor/utils\");\nconst connectSettings_1 = require(\"../connectSettings\");\nclass CoreInSuiteDesktop {\n  constructor() {\n    this.eventEmitter = new events_1.default();\n    this._settings = (0, connectSettings_1.parseConnectSettings)();\n    this.messages = (0, utils_1.createDeferredManager)();\n  }\n  manifest(data) {\n    this._settings = (0, connectSettings_1.parseConnectSettings)(Object.assign(Object.assign({}, this._settings), {\n      manifest: data\n    }));\n  }\n  dispose() {\n    var _a;\n    this.eventEmitter.removeAllListeners();\n    this._settings = (0, connectSettings_1.parseConnectSettings)();\n    (_a = this.ws) === null || _a === void 0 ? void 0 : _a.close();\n    return Promise.resolve(undefined);\n  }\n  cancel(_error) {}\n  async handshake() {\n    var _a;\n    const {\n      promise,\n      promiseId\n    } = this.messages.create(1000);\n    (_a = this.ws) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify({\n      id: promiseId,\n      type: events_2.POPUP.HANDSHAKE\n    }));\n    try {\n      await promise;\n    } catch (err) {\n      console.error(err);\n      throw new Error('Handshake timed out');\n    }\n  }\n  async init(settings = {}) {\n    var _a, _b;\n    const newSettings = (0, connectSettings_1.parseConnectSettings)(Object.assign(Object.assign({}, this._settings), settings));\n    if (!((_a = newSettings.transports) === null || _a === void 0 ? void 0 : _a.length)) {\n      newSettings.transports = ['BridgeTransport', 'WebUsbTransport'];\n    }\n    this._settings = newSettings;\n    (_b = this.ws) === null || _b === void 0 ? void 0 : _b.close();\n    const wsOpen = (0, utils_1.createDeferred)(1000);\n    this.ws = new WebSocket('ws://localhost:21335/connect-ws');\n    this.ws.addEventListener('opened', () => {\n      wsOpen.resolve();\n    });\n    this.ws.addEventListener('error', () => {\n      wsOpen.reject(new Error('WebSocket error'));\n      this.messages.rejectAll(new Error('WebSocket error'));\n    });\n    this.ws.addEventListener('message', event => {\n      try {\n        const data = JSON.parse(event.data);\n        this.messages.resolve(data.id, data);\n      } catch (_a) {}\n    });\n    this.ws.addEventListener('close', () => {\n      wsOpen.reject(new Error('WebSocket closed'));\n      this.messages.rejectAll(new Error('WebSocket closed'));\n    });\n    if (this.ws.readyState !== WebSocket.OPEN) {\n      setTimeout(() => {\n        var _a;\n        if (((_a = this.ws) === null || _a === void 0 ? void 0 : _a.readyState) === WebSocket.OPEN) {\n          wsOpen.resolve();\n        }\n      }, 500);\n      await wsOpen.promise;\n    }\n    return await this.handshake();\n  }\n  async call(params) {\n    var _a;\n    try {\n      if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n        await this.init();\n      }\n      await this.handshake();\n      const {\n        promise,\n        promiseId\n      } = this.messages.create();\n      (_a = this.ws) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify({\n        id: promiseId,\n        type: events_2.IFRAME.CALL,\n        payload: params\n      }));\n      return promise;\n    } catch (err) {\n      return {\n        success: false,\n        payload: {\n          error: err.message\n        }\n      };\n    }\n  }\n  uiResponse(_response) {\n    throw ERRORS.TypedError('Method_InvalidPackage');\n  }\n  requestLogin() {\n    throw ERRORS.TypedError('Method_InvalidPackage');\n  }\n  disableWebUSB() {\n    throw ERRORS.TypedError('Method_InvalidPackage');\n  }\n  requestWebUSBDevice() {\n    throw ERRORS.TypedError('Method_InvalidPackage');\n  }\n  renderWebUSBButton() {}\n}\nexports.CoreInSuiteDesktop = CoreInSuiteDesktop;\nconst impl = new CoreInSuiteDesktop();\nexports.TrezorConnect = (0, factory_1.factory)({\n  eventEmitter: impl.eventEmitter,\n  init: impl.init.bind(impl),\n  call: impl.call.bind(impl),\n  manifest: impl.manifest.bind(impl),\n  requestLogin: impl.requestLogin.bind(impl),\n  uiResponse: impl.uiResponse.bind(impl),\n  cancel: impl.cancel.bind(impl),\n  dispose: impl.dispose.bind(impl)\n});","map":{"version":3,"names":["Object","defineProperty","exports","value","TrezorConnect","CoreInSuiteDesktop","tslib_1","require","events_1","__importDefault","events_2","ERRORS","__importStar","factory_1","utils_1","connectSettings_1","constructor","eventEmitter","default","_settings","parseConnectSettings","messages","createDeferredManager","manifest","data","assign","dispose","_a","removeAllListeners","ws","close","Promise","resolve","undefined","cancel","_error","handshake","promise","promiseId","create","send","JSON","stringify","id","type","POPUP","HANDSHAKE","err","console","error","Error","init","settings","_b","newSettings","transports","length","wsOpen","createDeferred","WebSocket","addEventListener","reject","rejectAll","event","parse","readyState","OPEN","setTimeout","call","params","IFRAME","CALL","payload","success","message","uiResponse","_response","TypedError","requestLogin","disableWebUSB","requestWebUSBDevice","renderWebUSBButton","impl","factory","bind"],"sources":["/Users/papa/Desktop/trenchboard/trenchboard.io/node_modules/@trezor/connect-web/lib/impl/core-in-suite-desktop.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TrezorConnect = exports.CoreInSuiteDesktop = void 0;\nconst tslib_1 = require(\"tslib\");\nconst events_1 = tslib_1.__importDefault(require(\"events\"));\nconst events_2 = require(\"@trezor/connect/lib/events\");\nconst ERRORS = tslib_1.__importStar(require(\"@trezor/connect/lib/constants/errors\"));\nconst factory_1 = require(\"@trezor/connect/lib/factory\");\nconst utils_1 = require(\"@trezor/utils\");\nconst connectSettings_1 = require(\"../connectSettings\");\nclass CoreInSuiteDesktop {\n    constructor() {\n        this.eventEmitter = new events_1.default();\n        this._settings = (0, connectSettings_1.parseConnectSettings)();\n        this.messages = (0, utils_1.createDeferredManager)();\n    }\n    manifest(data) {\n        this._settings = (0, connectSettings_1.parseConnectSettings)(Object.assign(Object.assign({}, this._settings), { manifest: data }));\n    }\n    dispose() {\n        var _a;\n        this.eventEmitter.removeAllListeners();\n        this._settings = (0, connectSettings_1.parseConnectSettings)();\n        (_a = this.ws) === null || _a === void 0 ? void 0 : _a.close();\n        return Promise.resolve(undefined);\n    }\n    cancel(_error) { }\n    async handshake() {\n        var _a;\n        const { promise, promiseId } = this.messages.create(1000);\n        (_a = this.ws) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify({\n            id: promiseId,\n            type: events_2.POPUP.HANDSHAKE,\n        }));\n        try {\n            await promise;\n        }\n        catch (err) {\n            console.error(err);\n            throw new Error('Handshake timed out');\n        }\n    }\n    async init(settings = {}) {\n        var _a, _b;\n        const newSettings = (0, connectSettings_1.parseConnectSettings)(Object.assign(Object.assign({}, this._settings), settings));\n        if (!((_a = newSettings.transports) === null || _a === void 0 ? void 0 : _a.length)) {\n            newSettings.transports = ['BridgeTransport', 'WebUsbTransport'];\n        }\n        this._settings = newSettings;\n        (_b = this.ws) === null || _b === void 0 ? void 0 : _b.close();\n        const wsOpen = (0, utils_1.createDeferred)(1000);\n        this.ws = new WebSocket('ws://localhost:21335/connect-ws');\n        this.ws.addEventListener('opened', () => {\n            wsOpen.resolve();\n        });\n        this.ws.addEventListener('error', () => {\n            wsOpen.reject(new Error('WebSocket error'));\n            this.messages.rejectAll(new Error('WebSocket error'));\n        });\n        this.ws.addEventListener('message', (event) => {\n            try {\n                const data = JSON.parse(event.data);\n                this.messages.resolve(data.id, data);\n            }\n            catch (_a) {\n            }\n        });\n        this.ws.addEventListener('close', () => {\n            wsOpen.reject(new Error('WebSocket closed'));\n            this.messages.rejectAll(new Error('WebSocket closed'));\n        });\n        if (this.ws.readyState !== WebSocket.OPEN) {\n            setTimeout(() => {\n                var _a;\n                if (((_a = this.ws) === null || _a === void 0 ? void 0 : _a.readyState) === WebSocket.OPEN) {\n                    wsOpen.resolve();\n                }\n            }, 500);\n            await wsOpen.promise;\n        }\n        return await this.handshake();\n    }\n    async call(params) {\n        var _a;\n        try {\n            if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n                await this.init();\n            }\n            await this.handshake();\n            const { promise, promiseId } = this.messages.create();\n            (_a = this.ws) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify({\n                id: promiseId,\n                type: events_2.IFRAME.CALL,\n                payload: params,\n            }));\n            return promise;\n        }\n        catch (err) {\n            return {\n                success: false,\n                payload: {\n                    error: err.message,\n                },\n            };\n        }\n    }\n    uiResponse(_response) {\n        throw ERRORS.TypedError('Method_InvalidPackage');\n    }\n    requestLogin() {\n        throw ERRORS.TypedError('Method_InvalidPackage');\n    }\n    disableWebUSB() {\n        throw ERRORS.TypedError('Method_InvalidPackage');\n    }\n    requestWebUSBDevice() {\n        throw ERRORS.TypedError('Method_InvalidPackage');\n    }\n    renderWebUSBButton() { }\n}\nexports.CoreInSuiteDesktop = CoreInSuiteDesktop;\nconst impl = new CoreInSuiteDesktop();\nexports.TrezorConnect = (0, factory_1.factory)({\n    eventEmitter: impl.eventEmitter,\n    init: impl.init.bind(impl),\n    call: impl.call.bind(impl),\n    manifest: impl.manifest.bind(impl),\n    requestLogin: impl.requestLogin.bind(impl),\n    uiResponse: impl.uiResponse.bind(impl),\n    cancel: impl.cancel.bind(impl),\n    dispose: impl.dispose.bind(impl),\n});\n//# sourceMappingURL=core-in-suite-desktop.js.map"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}